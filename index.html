<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>BG Studio — 30 Dynamic Backgrounds</title>
<link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Syne:wght@700;800&display=swap" rel="stylesheet"/>
<style>
:root{
  --bg:#03050f;--surface:#080c1a;--surface2:#0d1224;
  --accent:#00ff41;--accent2:#00c8ff;
  --text:#cce8ff;--muted:#3a5070;--border:rgba(0,200,255,.13);
  --mono:'Share Tech Mono',monospace;
}
*{box-sizing:border-box;margin:0;padding:0}
html,body{width:100%;height:100%;background:var(--bg);color:var(--text);font-family:'Syne',sans-serif;overflow:hidden}

/* CANVAS */
#bgCanvas{position:fixed;top:0;left:0;width:100%;height:100%;z-index:0;pointer-events:none}

/* OVERLAY UI */
#app{position:fixed;inset:0;z-index:10;display:grid;grid-template-rows:auto 1fr auto;pointer-events:none}

/* HEADER */
#header{pointer-events:all;padding:14px 24px;background:rgba(3,5,15,.82);backdrop-filter:blur(14px);border-bottom:1px solid var(--border);display:flex;align-items:center;gap:20px;flex-wrap:wrap}
#title{font-size:14px;letter-spacing:.18em;color:var(--accent);text-transform:uppercase;white-space:nowrap}
#effectName{font-family:var(--mono);font-size:12px;color:var(--accent2);letter-spacing:.1em;min-width:220px}
.color-group{display:flex;align-items:center;gap:8px;margin-left:auto}
.clabel{font-family:var(--mono);font-size:10px;color:var(--muted);letter-spacing:.12em;text-transform:uppercase}
input[type=color]{width:32px;height:28px;border:1px solid var(--border);background:none;padding:2px;cursor:pointer;border-radius:2px}
input[type=color]:hover{border-color:var(--accent)}
#btnCode{font-family:var(--mono);font-size:11px;letter-spacing:.1em;text-transform:uppercase;padding:8px 16px;border:1px solid var(--accent);background:transparent;color:var(--accent);cursor:pointer;transition:all .2s;white-space:nowrap;pointer-events:all}
#btnCode:hover{background:var(--accent);color:var(--bg)}
#btnPrompt{font-family:var(--mono);font-size:11px;letter-spacing:.1em;text-transform:uppercase;padding:8px 16px;border:1px solid var(--accent2);background:transparent;color:var(--accent2);cursor:pointer;transition:all .2s;white-space:nowrap;pointer-events:all}
#btnPrompt:hover{background:var(--accent2);color:var(--bg)}

/* EFFECT GRID */
#grid{pointer-events:all;overflow-y:auto;padding:16px 24px;display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:6px;align-content:start}
#grid::-webkit-scrollbar{width:3px}
#grid::-webkit-scrollbar-thumb{background:var(--muted)}
.eBtn{font-family:var(--mono);font-size:10px;letter-spacing:.07em;text-transform:uppercase;padding:9px 12px;border:1px solid var(--border);background:rgba(8,12,26,.6);color:var(--muted);cursor:pointer;transition:all .18s;text-align:left;line-height:1.4}
.eBtn:hover{border-color:var(--accent2);color:var(--text)}
.eBtn.active{border-color:var(--accent);color:var(--accent);background:rgba(0,255,65,.06);box-shadow:0 0 12px rgba(0,255,65,.1)}
.eNum{font-size:9px;opacity:.5;display:block;margin-bottom:2px}

/* FOOTER */
#footer{pointer-events:all;padding:10px 24px;background:rgba(3,5,15,.85);backdrop-filter:blur(12px);border-top:1px solid var(--border);font-family:var(--mono);font-size:10px;color:var(--muted);letter-spacing:.1em;display:flex;align-items:center;gap:16px}
#footer span{color:var(--accent2)}

/* MODAL */
#modal{display:none;position:fixed;inset:0;z-index:200;background:rgba(3,5,15,.92);backdrop-filter:blur(8px);align-items:center;justify-content:center}
#modal.show{display:flex}
#modalBox{background:var(--surface);border:1px solid var(--border);max-width:760px;width:92%;max-height:82vh;display:flex;flex-direction:column;overflow:hidden}
#modalHeader{padding:16px 22px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between}
#modalTitle{font-family:var(--mono);font-size:12px;color:var(--accent);letter-spacing:.15em;text-transform:uppercase}
#modalClose{font-family:var(--mono);font-size:18px;color:var(--muted);cursor:pointer;background:none;border:none;line-height:1}
#modalClose:hover{color:var(--text)}
#modalTabs{display:flex;border-bottom:1px solid var(--border)}
.mTab{font-family:var(--mono);font-size:11px;letter-spacing:.1em;text-transform:uppercase;padding:10px 20px;border:none;background:none;color:var(--muted);cursor:pointer;border-bottom:2px solid transparent;transition:all .18s}
.mTab.active{color:var(--accent);border-bottom-color:var(--accent)}
#modalBody{padding:20px 22px;overflow-y:auto;flex:1}
#modalBody::-webkit-scrollbar{width:3px}
#modalBody::-webkit-scrollbar-thumb{background:var(--muted)}
pre{font-family:var(--mono);font-size:11px;line-height:1.7;color:#a8d8ff;white-space:pre-wrap;word-break:break-all}
.promptText{font-family:var(--mono);font-size:12px;line-height:1.8;color:var(--text)}
.promptText strong{color:var(--accent)}
#copyBtn{margin-top:16px;font-family:var(--mono);font-size:11px;letter-spacing:.1em;text-transform:uppercase;padding:9px 20px;border:1px solid var(--accent);background:transparent;color:var(--accent);cursor:pointer;transition:all .2s}
#copyBtn:hover{background:var(--accent);color:var(--bg)}
</style>
</head>
<body>
<canvas id="bgCanvas"></canvas>

<div id="app">
  <div id="header">
    <div id="title">BG Studio</div>
    <div id="effectName">01 · Particle Network</div>
    <div class="color-group">
      <span class="clabel">Color A</span>
      <input type="color" id="colA" value="#00ff41"/>
      <span class="clabel">Color B</span>
      <input type="color" id="colB" value="#00c8ff"/>
      <span class="clabel">Color C</span>
      <input type="color" id="colC" value="#4080ff"/>
    </div>
    <button id="btnCode" onclick="openModal('code')">Get Code</button>
    <button id="btnPrompt" onclick="openModal('prompt')">Get AI Prompt</button>
  </div>

  <div id="grid"></div>

  <div id="footer">
    <span>BG Studio</span> — pick an effect · adjust colors · export code or AI prompt
  </div>
</div>

<!-- MODAL -->
<div id="modal">
  <div id="modalBox">
    <div id="modalHeader">
      <span id="modalTitle">Export</span>
      <button id="modalClose" onclick="closeModal()">✕</button>
    </div>
    <div id="modalTabs">
      <button class="mTab active" onclick="switchTab('code')">HTML Snippet</button>
      <button class="mTab" onclick="switchTab('prompt')">AI Prompt</button>
    </div>
    <div id="modalBody"></div>
  </div>
</div>

<script>
// ═══════════════════════════════════════════════════════
// EFFECT REGISTRY
// ═══════════════════════════════════════════════════════
const EFFECTS = [
  {name:'Particle Network',     desc:'Floating dots connected by proximity lines, mouse-reactive'},
  {name:'Starfield Warp',       desc:'Stars rushing toward viewer — deep space warp effect'},
  {name:'Flowing Topology',     desc:'Layered sine contour lines morphing like terrain'},
  {name:'Falling Geometry',     desc:'Wireframe triangles, squares and hexagons drifting down'},
  {name:'Oscilloscope Waves',   desc:'Multi-layer sine waves rippling across screen'},
  {name:'Neural Network',       desc:'Nodes firing pulses along weighted connections'},
  {name:'Metaballs',            desc:'Organic blobs that merge and split fluidly'},
  {name:'DNA Helix',            desc:'Double helix rotating and scrolling vertically'},
  {name:'Perlin Flow Field',    desc:'Particles following smooth curved noise currents'},
  {name:'Grid Pulse',           desc:'Dot grid with expanding ripple waves'},
  {name:'Hex Grid Morph',       desc:'Honeycomb grid cells lighting up in waves'},
  {name:'Voronoi Cells',        desc:'Cracking cell diagram shifting like tectonic plates'},
  {name:'Aurora Borealis',      desc:'Soft curtains of light folding and breathing'},
  {name:'Circuit Board',        desc:'Animated traces routing across a PCB layout'},
  {name:'Rain Drops',           desc:'Rippling water drops landing on a reflective surface'},
  {name:'Constellation Map',    desc:'Star clusters connected like ancient constellations'},
  {name:'Fire Embers',          desc:'Glowing sparks rising and fading upward'},
  {name:'Lissajous Curves',     desc:'Parametric curves tracing hypnotic looping paths'},
  {name:'Smoke Tendrils',       desc:'Wispy smoke rising and dissipating organically'},
  {name:'Pixel Rain',           desc:'Square pixels cascading like digital rainfall'},
  {name:'Magnetic Field Lines', desc:'Field lines arcing between animated poles'},
  {name:'Sand Dunes',           desc:'Wind-sculpted sine ridges shifting slowly'},
  {name:'Neon Ribbons',         desc:'Glowing curved bands weaving through space'},
  {name:'Binary Tree',          desc:'Recursively growing fractal branches pulsing with data'},
  {name:'Liquid Crystal',       desc:'Iridescent liquid-crystal interference patterns'},
  {name:'Wormhole Tunnel',      desc:'Concentric rings rushing inward like a tunnel'},
  {name:'Lightning Storm',      desc:'Branching lightning bolts striking at intervals'},
  {name:'Cellular Automata',    desc:"Conway's Game of Life in glowing neon cells"},
  {name:'Orbital Rings',        desc:'Planets orbiting along tilted elliptical paths'},
  {name:'Terrain Flyover',      desc:'Wireframe 3D terrain scrolling under the viewer'},
];

const canvas = document.getElementById('bgCanvas');
const ctx = canvas.getContext('2d');
let W, H, raf, current = 0;

function resize(){
  W = canvas.width  = window.innerWidth;
  H = canvas.height = window.innerHeight;
}
resize();
window.addEventListener('resize', resize);

// Color helpers
function hexToRgb(h){
  const r=parseInt(h.slice(1,3),16),g=parseInt(h.slice(3,5),16),b=parseInt(h.slice(5,7),16);
  return [r,g,b];
}
function getColors(){
  return [
    hexToRgb(document.getElementById('colA').value),
    hexToRgb(document.getElementById('colB').value),
    hexToRgb(document.getElementById('colC').value),
  ];
}
function rc(cols){ return cols[Math.floor(Math.random()*cols.length)]; }
function rgba(c,a){ return `rgba(${c[0]},${c[1]},${c[2]},${a})`; }

// Perlin noise utility (shared)
function makeNoise(){
  const perm=new Uint8Array(512);
  const p=Array.from({length:256},(_,i)=>i);
  for(let i=255;i>0;i--){const j=Math.floor(Math.random()*(i+1));[p[i],p[j]]=[p[j],p[i]];}
  for(let i=0;i<512;i++)perm[i]=p[i&255];
  function fade(t){return t*t*t*(t*(t*6-15)+10);}
  function lerp(a,b,t){return a+(b-a)*t;}
  function grad(h,x,y){const u=h<8?x:y,v=h<4?y:h===12||h===14?x:0;return((h&1)?-u:u)+((h&2)?-v:v);}
  return function noise(x,y){
    const xi=Math.floor(x)&255,yi=Math.floor(y)&255;
    const xf=x-Math.floor(x),yf=y-Math.floor(y);
    const u=fade(xf),v=fade(yf);
    const aa=perm[perm[xi]+yi],ab=perm[perm[xi]+yi+1];
    const ba=perm[perm[xi+1]+yi],bb=perm[perm[xi+1]+yi+1];
    return lerp(lerp(grad(aa,xf,yf),grad(ba,xf-1,yf),u),lerp(grad(ab,xf,yf-1),grad(bb,xf-1,yf-1),u),v);
  };
}

let cleanupFn = null;
function stopEffect(){
  if(cleanupFn){cleanupFn();cleanupFn=null;}
  if(raf){cancelAnimationFrame(raf);raf=null;}
  canvas.onmousemove=null;
  ctx.clearRect(0,0,W,H);
}

function runEffect(n){
  stopEffect();
  current=n;
  document.getElementById('effectName').textContent = `${String(n+1).padStart(2,'0')} · ${EFFECTS[n].name}`;
  document.querySelectorAll('.eBtn').forEach((b,i)=>b.classList.toggle('active',i===n));
  DRAW[n]();
}

// Color picker reactivity
['colA','colB','colC'].forEach(id=>{
  document.getElementById(id).addEventListener('input',()=>runEffect(current));
});

// ═══════════════════════════════════════════════════════
// ALL 30 EFFECTS
// ═══════════════════════════════════════════════════════
const DRAW = [

// 01 PARTICLE NETWORK
()=>{
  const cols=getColors();
  const pts=Array.from({length:110},()=>({x:Math.random()*W,y:Math.random()*H,vx:(Math.random()-.5)*.45,vy:(Math.random()-.5)*.45,r:Math.random()*1.4+.5,col:rc(cols)}));
  let mx=-9999,my=-9999;
  canvas.onmousemove=e=>{mx=e.clientX;my=e.clientY};
  const loop=()=>{
    ctx.fillStyle='rgba(3,5,15,.18)';ctx.fillRect(0,0,W,H);
    for(const p of pts){
      p.x+=p.vx;p.y+=p.vy;
      if(p.x<0||p.x>W)p.vx*=-1;if(p.y<0||p.y>H)p.vy*=-1;
      const dx=p.x-mx,dy=p.y-my,d=Math.sqrt(dx*dx+dy*dy);
      if(d<120){p.vx+=dx/d*.035;p.vy+=dy/d*.035;}
      ctx.beginPath();ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
      ctx.fillStyle=rgba(p.col,.85);ctx.fill();
    }
    for(let i=0;i<pts.length;i++)for(let j=i+1;j<pts.length;j++){
      const dx=pts[i].x-pts[j].x,dy=pts[i].y-pts[j].y,d=Math.sqrt(dx*dx+dy*dy);
      if(d<130){ctx.beginPath();ctx.moveTo(pts[i].x,pts[i].y);ctx.lineTo(pts[j].x,pts[j].y);
        ctx.strokeStyle=rgba(pts[i].col,(1-d/130)*.3);ctx.lineWidth=.6;ctx.stroke();}
    }
    raf=requestAnimationFrame(loop);
  };loop();
},

// 02 STARFIELD WARP
()=>{
  const cols=getColors();
  const stars=Array.from({length:280},()=>({x:(Math.random()-.5)*W*3,y:(Math.random()-.5)*H*3,z:Math.random()*W,pz:0}));
  const loop=()=>{
    ctx.fillStyle='rgba(3,5,15,.28)';ctx.fillRect(0,0,W,H);
    for(const s of stars){
      s.pz=s.z;s.z-=5;
      if(s.z<=0){s.x=(Math.random()-.5)*W*3;s.y=(Math.random()-.5)*H*3;s.z=W;s.pz=W;}
      const sx=s.x/s.z*W+W/2,sy=s.y/s.z*H+H/2;
      const px=s.x/s.pz*W+W/2,py=s.y/s.pz*H+H/2;
      const br=1-s.z/W,col=cols[Math.floor(br*cols.length)%cols.length];
      ctx.beginPath();ctx.moveTo(px,py);ctx.lineTo(sx,sy);
      ctx.strokeStyle=rgba(col,br*.9);ctx.lineWidth=Math.max(.1,br*2.5);ctx.stroke();
    }
    raf=requestAnimationFrame(loop);
  };loop();
},

// 03 FLOWING TOPOLOGY
()=>{
  const cols=getColors();const noise=makeNoise();let t=0;
  const loop=()=>{
    ctx.fillStyle='rgba(3,5,15,.1)';ctx.fillRect(0,0,W,H);t+=.004;
    for(let l=0;l<10;l++){
      ctx.beginPath();let first=true;
      for(let x=0;x<W;x+=5){
        const y=H/2+noise(x*.003+t*.4,l*.38)*H*.42+Math.sin(x*.007+t+l*.8)*H*.055;
        first?(ctx.moveTo(x,y),first=false):ctx.lineTo(x,y);
      }
      const col=cols[l%cols.length];
      ctx.strokeStyle=rgba(col,.07+l*.018);ctx.lineWidth=1.3;ctx.stroke();
    }
    raf=requestAnimationFrame(loop);
  };loop();
},

// 04 FALLING GEOMETRY
()=>{
  const cols=getColors();
  const mk=()=>{const col=rc(cols);return{x:Math.random()*W,y:Math.random()*H-H,vy:.3+Math.random()*.7,vr:.004+Math.random()*.014,rot:Math.random()*Math.PI*2,sz:10+Math.random()*30,sides:[3,4,6][Math.floor(Math.random()*3)],col,a:.1+Math.random()*.3};};
  const shapes=Array.from({length:40},mk);
  const loop=()=>{
    ctx.fillStyle='rgba(3,5,15,.14)';ctx.fillRect(0,0,W,H);
    for(const s of shapes){
      s.y+=s.vy;s.rot+=s.vr;
      if(s.y>H+60)Object.assign(s,mk(),{y:-60,x:Math.random()*W});
      ctx.beginPath();
      for(let i=0;i<s.sides;i++){const a=s.rot+i*(Math.PI*2/s.sides);i===0?ctx.moveTo(s.x+Math.cos(a)*s.sz,s.y+Math.sin(a)*s.sz):ctx.lineTo(s.x+Math.cos(a)*s.sz,s.y+Math.sin(a)*s.sz);}
      ctx.closePath();ctx.strokeStyle=rgba(s.col,s.a);ctx.lineWidth=1.2;ctx.stroke();
    }
    raf=requestAnimationFrame(loop);
  };loop();
},

// 05 OSCILLOSCOPE WAVES
()=>{
  const cols=getColors();let t=0;
  const loop=()=>{
    ctx.fillStyle='rgba(3,5,15,.13)';ctx.fillRect(0,0,W,H);t+=.018;
    for(let w=0;w<6;w++){
      const col=cols[w%cols.length];const amp=H*.055+w*(H*.03);
      const yOff=H/2+(w-2.5)*(H*.07);
      ctx.beginPath();
      for(let x=0;x<=W;x+=2){
        const y=yOff+Math.sin(x*.011*(1+w*.4)+t+w)*amp+Math.sin(x*.025+t*1.4+w)*amp*.35;
        x===0?ctx.moveTo(x,y):ctx.lineTo(x,y);
      }
      ctx.strokeStyle=rgba(col,.12+w*.04);ctx.lineWidth=1.4;ctx.stroke();
    }
    // bright center
    ctx.beginPath();
    for(let x=0;x<=W;x+=2){const y=H/2+Math.sin(x*.01+t)*H*.1+Math.sin(x*.028+t*2)*H*.03;x===0?ctx.moveTo(x,y):ctx.lineTo(x,y);}
    ctx.strokeStyle=rgba(cols[0],.6);ctx.lineWidth=1.8;ctx.stroke();
    raf=requestAnimationFrame(loop);
  };loop();
},

// 06 NEURAL NETWORK
()=>{
  const cols=getColors();
  const LAYERS=[3,5,5,5,3];const nodes=[];
  const lw=W*.55,lh=H*.6,cx=W/2,cy=H/2;
  for(let l=0;l<LAYERS.length;l++){
    const x=cx-lw/2+l*(lw/(LAYERS.length-1));
    for(let n=0;n<LAYERS[l];n++){
      const y=cy-lh/2+(n+.5)*(lh/LAYERS[l]);
      nodes.push({x,y,l,pulse:0,phase:Math.random()*Math.PI*2,col:cols[l%cols.length]});
    }
  }
  const edges=[];
  for(let i=0;i<nodes.length;i++)for(let j=0;j<nodes.length;j++){
    if(nodes[j].l===nodes[i].l+1)edges.push({a:i,b:j,t:0,on:false,timer:Math.random()*200,col:rc(cols)});
  }
  let T=0;
  const loop=()=>{
    ctx.fillStyle='rgba(3,5,15,.2)';ctx.fillRect(0,0,W,H);T++;
    for(const e of edges){
      e.timer--;if(e.timer<=0){e.on=true;e.t=0;e.timer=60+Math.random()*160;}
      if(e.on){e.t+=.028;if(e.t>=1){e.on=false;nodes[e.b].pulse=1;}}
      const a=nodes[e.a],b=nodes[e.b];
      ctx.beginPath();ctx.moveTo(a.x,a.y);ctx.lineTo(b.x,b.y);
      ctx.strokeStyle=rgba(a.col,.07);ctx.lineWidth=.8;ctx.stroke();
      if(e.on){const px=a.x+(b.x-a.x)*e.t,py=a.y+(b.y-a.y)*e.t;
        ctx.beginPath();ctx.arc(px,py,3,0,Math.PI*2);ctx.fillStyle=rgba(e.col,.95);ctx.fill();
        ctx.beginPath();ctx.arc(px,py,7,0,Math.PI*2);ctx.fillStyle=rgba(e.col,.12);ctx.fill();}
    }
    for(const nd of nodes){
      nd.pulse*=.92;const g=.3+nd.pulse*.7+Math.sin(nd.phase+T*.04)*.12;
      ctx.beginPath();ctx.arc(nd.x,nd.y,5+nd.pulse*4,0,Math.PI*2);ctx.fillStyle=rgba(nd.col,g);ctx.fill();
      ctx.beginPath();ctx.arc(nd.x,nd.y,12+nd.pulse*5,0,Math.PI*2);ctx.fillStyle=rgba(nd.col,g*.1);ctx.fill();
    }
    raf=requestAnimationFrame(loop);
  };loop();
},

// 07 METABALLS
()=>{
  const cols=getColors();
  const balls=Array.from({length:6},()=>({x:Math.random()*W,y:Math.random()*H,vx:(Math.random()-.5)*.7,vy:(Math.random()-.5)*.7,r:70+Math.random()*90}));
  const SC=4;const ow=Math.floor(W/SC),oh=Math.floor(H/SC);
  const off=document.createElement('canvas');off.width=ow;off.height=oh;const octx=off.getContext('2d');
  const loop=()=>{
    ctx.fillStyle='rgba(3,5,15,.3)';ctx.fillRect(0,0,W,H);
    for(const b of balls){b.x+=b.vx;b.y+=b.vy;if(b.x<0||b.x>W)b.vx*=-1;if(b.y<0||b.y>H)b.vy*=-1;}
    const id=octx.createImageData(ow,oh);
    for(let y=0;y<oh;y++)for(let x=0;x<ow;x++){
      let v=0;for(const b of balls){const dx=x*SC-b.x,dy=y*SC-b.y;v+=b.r*b.r/(dx*dx+dy*dy+1);}
      const i=(y*ow+x)*4;
      if(v>1){const t2=Math.min(1,(v-1)*2.5);const col=cols[Math.floor(t2*cols.length)%cols.length];
        id.data[i]=col[0];id.data[i+1]=col[1];id.data[i+2]=col[2];id.data[i+3]=Math.floor(t2*200);}
    }
    octx.putImageData(id,0,0);ctx.drawImage(off,0,0,W,H);
    raf=requestAnimationFrame(loop);
  };loop();
},

// 08 DNA HELIX
()=>{
  const cols=getColors();let t=0;
  const loop=()=>{
    ctx.fillStyle='rgba(3,5,15,.13)';ctx.fillRect(0,0,W,H);t+=.022;
    const cx=W/2,amp=W*.11,freq=.017;
    const steps=Math.ceil(H/7);
    for(let s=0;s<2;s++){
      const ph=s*Math.PI;
      ctx.beginPath();
      for(let i=0;i<=steps;i++){const y=i*(H/steps);const x=cx+Math.sin(y*freq+t+ph)*amp;i===0?ctx.moveTo(x,y):ctx.lineTo(x,y);}
      ctx.strokeStyle=rgba(cols[s%cols.length],.55);ctx.lineWidth=2;ctx.stroke();
    }
    for(let i=0;i<=steps;i+=3){
      const y=i*(H/steps);
      const x1=cx+Math.sin(y*freq+t)*amp,x2=cx+Math.sin(y*freq+t+Math.PI)*amp;
      const m=Math.abs(Math.sin(y*freq+t));
      ctx.beginPath();ctx.moveTo(x1,y);ctx.lineTo(x2,y);
      ctx.strokeStyle=rgba(cols[2%cols.length],.12+m*.22);ctx.lineWidth=1.1;ctx.stroke();
      ctx.beginPath();ctx.arc(x1,y,2.2,0,Math.PI*2);ctx.fillStyle=rgba(cols[0],.85);ctx.fill();
      ctx.beginPath();ctx.arc(x2,y,2.2,0,Math.PI*2);ctx.fillStyle=rgba(cols[1%cols.length],.85);ctx.fill();
    }
    raf=requestAnimationFrame(loop);
  };loop();
},

// 09 PERLIN FLOW FIELD
()=>{
  const cols=getColors();const noise=makeNoise();
  const pts=Array.from({length:650},()=>{const col=rc(cols);return{x:Math.random()*W,y:Math.random()*H,life:0,max:160+Math.random()*200,spd:.9+Math.random()*.7,r:col[0],g:col[1],b:col[2],sz:.5+Math.random()*1.1};});
  let T=0;ctx.fillStyle='#03050f';ctx.fillRect(0,0,W,H);
  const loop=()=>{
    ctx.fillStyle='rgba(3,5,15,.018)';ctx.fillRect(0,0,W,H);T+=.0005;
    for(const p of pts){
      const px=p.x,py=p.y;
      const angle=noise(p.x*.0032,p.y*.0032+T)*Math.PI*4;
      p.x+=Math.cos(angle)*p.spd;p.y+=Math.sin(angle)*p.spd;p.life++;
      const lr=p.life/p.max;const a=lr<.1?lr*10*.5:lr>.85?(1-lr)/.15*.5:.5;
      ctx.beginPath();ctx.moveTo(px,py);ctx.lineTo(p.x,p.y);
      ctx.strokeStyle=`rgba(${p.r},${p.g},${p.b},${a})`;ctx.lineWidth=p.sz;ctx.stroke();
      if(p.life>=p.max||p.x<-5||p.x>W+5||p.y<-5||p.y>H+5){
        const col=rc(cols);Object.assign(p,{x:Math.random()<.5?0:W,y:Math.random()*H,life:0,max:160+Math.random()*200,r:col[0],g:col[1],b:col[2]});
      }
    }
    raf=requestAnimationFrame(loop);
  };loop();
},

// 10 GRID PULSE
()=>{
  const cols=getColors();const CELL=50;
  const gc=Math.ceil(W/CELL)+1,gr=Math.ceil(H/CELL)+1;
  const cells=Array.from({length:gc*gr},()=>({phase:Math.random()*Math.PI*2,spd:.008+Math.random()*.018,col:rc(cols)}));
  let ripples=[],T=0;
  const spawnR=()=>ripples.push({cx:Math.floor(Math.random()*gc),cy:Math.floor(Math.random()*gr),r:0,maxR:Math.max(gc,gr)*.75,spd:.2+Math.random()*.15,col:rc(cols),str:.6+Math.random()*.35});
  spawnR();const ri=setInterval(spawnR,1800);cleanupFn=()=>clearInterval(ri);
  const loop=()=>{
    ctx.clearRect(0,0,W,H);T+=.012;
    ctx.strokeStyle='rgba(0,180,220,.04)';ctx.lineWidth=.5;
    for(let c=0;c<=gc;c++){ctx.beginPath();ctx.moveTo(c*CELL,0);ctx.lineTo(c*CELL,H);ctx.stroke();}
    for(let r=0;r<=gr;r++){ctx.beginPath();ctx.moveTo(0,r*CELL);ctx.lineTo(W,r*CELL);ctx.stroke();}
    for(let c=0;c<=gc;c++)for(let r=0;r<=gr;r++){
      const cell=cells[(c%gc+(r%gr)*gc)%cells.length];
      const base=(Math.sin(cell.phase+T*cell.spd*80)+1)*.5;
      let rA=0;for(const rp of ripples){const d=Math.sqrt((c-rp.cx)**2+(r-rp.cy)**2);rA+=Math.sin((d-rp.r)*1.8)*rp.str*Math.max(0,1-Math.abs(d-rp.r)/3.5)*Math.max(0,1-rp.r/rp.maxR);}
      const br=Math.max(0,Math.min(1,base*.2+rA*.8));if(br<.02)continue;
      const rad=.8+br*3;ctx.beginPath();ctx.arc(c*CELL,r*CELL,rad,0,Math.PI*2);ctx.fillStyle=rgba(cell.col,br*.9);ctx.fill();
      if(br>.5){ctx.beginPath();ctx.arc(c*CELL,r*CELL,rad*2.8,0,Math.PI*2);ctx.fillStyle=rgba(cell.col,br*.1);ctx.fill();}
    }
    for(let i=ripples.length-1;i>=0;i--){ripples[i].r+=ripples[i].spd*2.5;if(ripples[i].r>ripples[i].maxR)ripples.splice(i,1);}
    for(const c of cells)c.phase+=c.spd*.04;
    raf=requestAnimationFrame(loop);
  };loop();
},

// 11 HEX GRID MORPH
()=>{
  const cols=getColors();let T=0;
  const S=44;const hexes=[];
  for(let r=0;r<Math.ceil(H/(S*1.5))+1;r++)for(let c=0;c<Math.ceil(W/(S*1.732))+1;c++){
    hexes.push({cx:c*S*1.732+(r%2)*S*.866,cy:r*S*1.5,phase:Math.random()*Math.PI*2,spd:.008+Math.random()*.012,col:rc(cols)});
  }
  const loop=()=>{
    ctx.clearRect(0,0,W,H);T+=.008;
    for(const h of hexes){
      h.phase+=h.spd;const br=(Math.sin(h.phase)+1)*.5*.4;if(br<.01)continue;
      ctx.beginPath();for(let i=0;i<6;i++){const a=Math.PI/3*i;i===0?ctx.moveTo(h.cx+S*.46*Math.cos(a),h.cy+S*.46*Math.sin(a)):ctx.lineTo(h.cx+S*.46*Math.cos(a),h.cy+S*.46*Math.sin(a));}
      ctx.closePath();ctx.strokeStyle=rgba(h.col,br);ctx.lineWidth=1;ctx.stroke();
      ctx.fillStyle=rgba(h.col,br*.18);ctx.fill();
    }
    raf=requestAnimationFrame(loop);
  };loop();
},

// 12 VORONOI CELLS
()=>{
  const cols=getColors();
  const pts=Array.from({length:28},()=>({x:Math.random()*W,y:Math.random()*H,vx:(Math.random()-.5)*.4,vy:(Math.random()-.5)*.4,col:rc(cols)}));
  const RES=6;let T=0;
  const loop=()=>{
    T++;for(const p of pts){p.x+=p.vx;p.y+=p.vy;if(p.x<0||p.x>W)p.vx*=-1;if(p.y<0||p.y>H)p.vy*=-1;}
    for(let y=0;y<H;y+=RES)for(let x=0;x<W;x+=RES){
      let best=Infinity,bcol=cols[0],best2=Infinity;
      for(const p of pts){const d=(x-p.x)**2+(y-p.y)**2;if(d<best){best2=best;best=d;bcol=p.col;}else if(d<best2)best2=d;}
      const edge=Math.sqrt(best2)-Math.sqrt(best);
      if(edge<8){ctx.fillStyle=rgba(bcol,Math.min(1,(8-edge)/8)*.35);ctx.fillRect(x,y,RES,RES);}
    }
    raf=requestAnimationFrame(loop);
  };loop();
},

// 13 AURORA BOREALIS
()=>{
  const cols=getColors();const noise=makeNoise();let T=0;
  const loop=()=>{
    ctx.fillStyle='rgba(3,5,15,.06)';ctx.fillRect(0,0,W,H);T+=.003;
    for(let band=0;band<5;band++){
      const yBase=H*.15+band*(H*.15);
      ctx.beginPath();ctx.moveTo(0,H);
      for(let x=0;x<=W;x+=4){
        const n=noise(x*.002+T+band*.5,T*.3+band*.3);
        const y=yBase+n*H*.22+Math.sin(x*.006+T*1.5+band)*H*.06;
        ctx.lineTo(x,y);
      }
      ctx.lineTo(W,H);ctx.closePath();
      const col=cols[band%cols.length];
      const grad=ctx.createLinearGradient(0,yBase-H*.2,0,yBase+H*.05);
      grad.addColorStop(0,rgba(col,0));
      grad.addColorStop(.5,rgba(col,.06+band*.01));
      grad.addColorStop(1,rgba(col,0));
      ctx.fillStyle=grad;ctx.fill();
    }
    raf=requestAnimationFrame(loop);
  };loop();
},

// 14 CIRCUIT BOARD
()=>{
  const cols=getColors();
  const GRID=40;const gc2=Math.ceil(W/GRID)+1,gr2=Math.ceil(H/GRID)+1;
  const traces=[];
  for(let i=0;i<60;i++){
    const x1=Math.floor(Math.random()*gc2)*GRID,y1=Math.floor(Math.random()*gr2)*GRID;
    const horiz=Math.random()>.5;
    const len=(2+Math.floor(Math.random()*6))*GRID;
    traces.push({x1,y1,x2:horiz?x1+len:x1,y2:horiz?y1:y1+len,t:0,spd:.004+Math.random()*.008,col:rc(cols),active:Math.random()>.4});
  }
  const loop=()=>{
    ctx.fillStyle='rgba(3,5,15,.15)';ctx.fillRect(0,0,W,H);
    for(const tr of traces){
      ctx.beginPath();ctx.moveTo(tr.x1,tr.y1);ctx.lineTo(tr.x2,tr.y2);
      ctx.strokeStyle=rgba(tr.col,.06);ctx.lineWidth=1;ctx.stroke();
      if(tr.active){
        tr.t+=tr.spd;if(tr.t>1.3)tr.t=-.2;
        const t2=Math.max(0,Math.min(1,tr.t));
        const px=tr.x1+(tr.x2-tr.x1)*t2,py=tr.y1+(tr.y2-tr.y1)*t2;
        ctx.beginPath();ctx.arc(px,py,2.5,0,Math.PI*2);ctx.fillStyle=rgba(tr.col,.9);ctx.fill();
        ctx.beginPath();ctx.arc(px,py,6,0,Math.PI*2);ctx.fillStyle=rgba(tr.col,.15);ctx.fill();
      }
      ctx.beginPath();ctx.arc(tr.x1,tr.y1,2,0,Math.PI*2);ctx.fillStyle=rgba(tr.col,.3);ctx.fill();
      ctx.beginPath();ctx.arc(tr.x2,tr.y2,2,0,Math.PI*2);ctx.fillStyle=rgba(tr.col,.3);ctx.fill();
    }
    raf=requestAnimationFrame(loop);
  };loop();
},

// 15 RAIN DROPS
()=>{
  const cols=getColors();
  const drops=Array.from({length:200},()=>({x:Math.random()*W,y:Math.random()*H,vy:4+Math.random()*6,len:8+Math.random()*16,col:rc(cols)}));
  const ripples=[];
  const loop=()=>{
    ctx.fillStyle='rgba(3,5,15,.2)';ctx.fillRect(0,0,W,H);
    for(const d of drops){
      d.y+=d.vy;
      if(d.y>H){ripples.push({x:d.x,y:H*.9,r:0,max:30+Math.random()*20,col:d.col});d.y=Math.random()*-20;d.x=Math.random()*W;}
      ctx.beginPath();ctx.moveTo(d.x,d.y);ctx.lineTo(d.x,d.y-d.len);
      ctx.strokeStyle=rgba(d.col,.3);ctx.lineWidth=.8;ctx.stroke();
    }
    for(let i=ripples.length-1;i>=0;i--){
      const rp=ripples[i];rp.r+=1.2;
      const a=(1-rp.r/rp.max)*.4;
      ctx.beginPath();ctx.ellipse(rp.x,rp.y,rp.r,rp.r*.35,0,0,Math.PI*2);
      ctx.strokeStyle=rgba(rp.col,a);ctx.lineWidth=.8;ctx.stroke();
      if(rp.r>=rp.max)ripples.splice(i,1);
    }
    raf=requestAnimationFrame(loop);
  };loop();
},

// 16 CONSTELLATION MAP
()=>{
  const cols=getColors();
  const stars=Array.from({length:120},()=>({x:Math.random()*W,y:Math.random()*H,r:.5+Math.random()*2,twinkle:Math.random()*Math.PI*2,spd:.02+Math.random()*.04,col:rc(cols)}));
  const edges=[];
  for(let i=0;i<stars.length;i++){let count=0;for(let j=0;j<stars.length&&count<3;j++){if(i!==j){const d=Math.hypot(stars[i].x-stars[j].x,stars[i].y-stars[j].y);if(d<W*.12){edges.push({a:i,b:j});count++;}}}}
  let T=0;
  const loop=()=>{
    ctx.fillStyle='rgba(3,5,15,.15)';ctx.fillRect(0,0,W,H);T+=.015;
    for(const e of edges){const a=stars[e.a],b=stars[e.b];const d=Math.hypot(a.x-b.x,a.y-b.y);
      ctx.beginPath();ctx.moveTo(a.x,a.y);ctx.lineTo(b.x,b.y);ctx.strokeStyle=rgba(a.col,(1-d/(W*.12))*.12);ctx.lineWidth=.5;ctx.stroke();}
    for(const s of stars){s.twinkle+=s.spd;const a=.4+Math.sin(s.twinkle)*.35;
      ctx.beginPath();ctx.arc(s.x,s.y,s.r,0,Math.PI*2);ctx.fillStyle=rgba(s.col,a);ctx.fill();
      ctx.beginPath();ctx.arc(s.x,s.y,s.r*2.5,0,Math.PI*2);ctx.fillStyle=rgba(s.col,a*.1);ctx.fill();}
    raf=requestAnimationFrame(loop);
  };loop();
},

// 17 FIRE EMBERS
()=>{
  const cols=getColors();
  const embers=Array.from({length:180},()=>mkEmber());
  function mkEmber(){const col=rc(cols);return{x:W*.2+Math.random()*W*.6,y:H+Math.random()*20,vx:(Math.random()-.5)*.8,vy:-(1.5+Math.random()*3),life:0,max:60+Math.random()*120,r:.8+Math.random()*2.5,col};}
  const loop=()=>{
    ctx.fillStyle='rgba(3,5,15,.16)';ctx.fillRect(0,0,W,H);
    for(let i=0;i<embers.length;i++){
      const e=embers[i];e.x+=e.vx+Math.sin(e.life*.08)*.5;e.y+=e.vy;e.vy*=.99;e.life++;
      const a=(1-e.life/e.max)*.85;
      ctx.beginPath();ctx.arc(e.x,e.y,e.r,0,Math.PI*2);ctx.fillStyle=rgba(e.col,a);ctx.fill();
      ctx.beginPath();ctx.arc(e.x,e.y,e.r*2.5,0,Math.PI*2);ctx.fillStyle=rgba(e.col,a*.15);ctx.fill();
      if(e.life>=e.max||e.y<-10)embers[i]=mkEmber();
    }
    raf=requestAnimationFrame(loop);
  };loop();
},

// 18 LISSAJOUS CURVES
()=>{
  const cols=getColors();let t=0;
  const curves=[{a:3,b:2,d:.5},{a:5,b:4,d:.2},{a:2,b:3,d:1.2},{a:7,b:6,d:.8}];
  const loop=()=>{
    ctx.fillStyle='rgba(3,5,15,.04)';ctx.fillRect(0,0,W,H);t+=.006;
    for(let ci=0;ci<curves.length;ci++){
      const c=curves[ci];const col=cols[ci%cols.length];
      ctx.beginPath();let first=true;
      for(let i=0;i<1000;i++){const s=i/1000*Math.PI*2;
        const x=W/2+Math.sin(c.a*s+c.d+t)*W*.36;const y=H/2+Math.sin(c.b*s+t*.7)*H*.38;
        first?(ctx.moveTo(x,y),first=false):ctx.lineTo(x,y);}
      ctx.strokeStyle=rgba(col,.18);ctx.lineWidth=1.2;ctx.stroke();
    }
    raf=requestAnimationFrame(loop);
  };loop();
},

// 19 SMOKE TENDRILS
()=>{
  const cols=getColors();const noise=makeNoise();
  const particles=Array.from({length:300},()=>mkSmoke());
  function mkSmoke(){const col=rc(cols);return{x:W*.1+Math.random()*W*.8,y:H+Math.random()*30,vx:(Math.random()-.5)*.3,vy:-(0.4+Math.random()*.8),life:0,max:120+Math.random()*180,sz:4+Math.random()*12,col,a:Math.random()*.12};}
  let T=0;
  const loop=()=>{
    ctx.fillStyle='rgba(3,5,15,.06)';ctx.fillRect(0,0,W,H);T+=.001;
    for(let i=0;i<particles.length;i++){
      const p=particles[i];
      const n=noise(p.x*.004,p.y*.004+T)*2;
      p.x+=p.vx+Math.cos(n)*0.4;p.y+=p.vy;p.sz+=.04;p.life++;
      const lr=p.life/p.max;const a=lr<.15?lr/15*p.a:lr>.7?(1-lr)/.3*p.a:p.a;
      ctx.beginPath();ctx.arc(p.x,p.y,p.sz,0,Math.PI*2);ctx.fillStyle=rgba(p.col,a);ctx.fill();
      if(p.life>=p.max||p.y<-50)particles[i]=mkSmoke();
    }
    raf=requestAnimationFrame(loop);
  };loop();
},

// 20 PIXEL RAIN
()=>{
  const cols=getColors();const SZ=8;
  const pc=Math.floor(W/SZ);const drops=Array.from({length:pc},(_,i)=>({x:i*SZ,y:Math.random()*-H,spd:2+Math.random()*5,len:4+Math.floor(Math.random()*10),col:rc(cols)}));
  const loop=()=>{
    ctx.fillStyle='rgba(3,5,15,.22)';ctx.fillRect(0,0,W,H);
    for(const d of drops){
      for(let i=0;i<d.len;i++){
        const py=d.y-i*SZ;if(py<0||py>H)continue;
        const a=i===0?.9:(1-i/d.len)*.45;
        ctx.fillStyle=rgba(d.col,a);ctx.fillRect(d.x,py,SZ-1,SZ-1);
      }
      d.y+=d.spd;if(d.y>H+d.len*SZ){d.y=Math.random()*-80;d.spd=2+Math.random()*5;d.col=rc(cols);}
    }
    raf=requestAnimationFrame(loop);
  };loop();
},

// 21 MAGNETIC FIELD LINES
()=>{
  const cols=getColors();
  const poles=[{x:W*.3,y:H*.5,sign:1,col:cols[0]},{x:W*.7,y:H*.5,sign:-1,col:cols[1%cols.length]}];
  const lines=[];const NUM=60;
  for(let i=0;i<NUM;i++){const a=i/NUM*Math.PI*2;lines.push({pts:[{x:poles[0].x+Math.cos(a)*20,y:poles[0].y+Math.sin(a)*20}],done:false});}
  let traced=false;
  const trace=()=>{for(const l of lines){if(l.done)continue;for(let s=0;s<200;s++){const last=l.pts[l.pts.length-1];let fx=0,fy=0;for(const p of poles){const dx=last.x-p.x,dy=last.y-p.y,d2=dx*dx+dy*dy+1;fx+=p.sign*dx/d2*5000;fy+=p.sign*dy/d2*5000;}const len=Math.sqrt(fx*fx+fy*fy);fx/=len;fy/=len;const nx=last.x+fx*4,ny=last.y+fy*4;l.pts.push({x:nx,y:ny});if(nx<0||nx>W||ny<0||ny>H||l.pts.length>300){l.done=true;break;}}}traced=true;};
  trace();let T=0;
  const loop=()=>{
    ctx.fillStyle='rgba(3,5,15,.12)';ctx.fillRect(0,0,W,H);T+=.015;
    for(let li=0;li<lines.length;li++){
      const l=lines[li];if(l.pts.length<2)continue;
      const col=cols[li%cols.length];
      ctx.beginPath();ctx.moveTo(l.pts[0].x,l.pts[0].y);
      for(const pt of l.pts)ctx.lineTo(pt.x,pt.y);
      ctx.strokeStyle=rgba(col,.12);ctx.lineWidth=.8;ctx.stroke();
      // travelling dot
      const idx=Math.floor((T*30+li*7)%l.pts.length);
      const pt=l.pts[idx];
      ctx.beginPath();ctx.arc(pt.x,pt.y,2,0,Math.PI*2);ctx.fillStyle=rgba(col,.8);ctx.fill();
    }
    for(const p of poles){ctx.beginPath();ctx.arc(p.x,p.y,8,0,Math.PI*2);ctx.fillStyle=rgba(p.col,.7);ctx.fill();ctx.beginPath();ctx.arc(p.x,p.y,18,0,Math.PI*2);ctx.fillStyle=rgba(p.col,.15);ctx.fill();}
    raf=requestAnimationFrame(loop);
  };loop();
},

// 22 SAND DUNES
()=>{
  const cols=getColors();const noise=makeNoise();let T=0;
  const loop=()=>{
    ctx.fillStyle='rgba(3,5,15,.08)';ctx.fillRect(0,0,W,H);T+=.002;
    for(let d=0;d<12;d++){
      const yBase=H*.1+d*(H*.075);
      ctx.beginPath();ctx.moveTo(0,H);
      for(let x=0;x<=W;x+=4){
        const n=noise(x*.004+T*.5+d*.3,d*.5+T*.2);
        const y=yBase+n*H*.09+Math.sin(x*.005+T+d*.7)*H*.04;
        x===0?ctx.moveTo(x,y):ctx.lineTo(x,y);
      }
      ctx.lineTo(W,H);ctx.closePath();
      const col=cols[d%cols.length];
      ctx.fillStyle=rgba(col,.04+d*.005);ctx.fill();
      ctx.strokeStyle=rgba(col,.08+d*.01);ctx.lineWidth=.8;ctx.stroke();
    }
    raf=requestAnimationFrame(loop);
  };loop();
},

// 23 NEON RIBBONS
()=>{
  const cols=getColors();const noise=makeNoise();
  const ribbons=Array.from({length:8},(_,i)=>({phase:i*(Math.PI*2/8),speed:.006+Math.random()*.006,amp:H*.2+Math.random()*H*.15,yOff:H*.1+Math.random()*H*.8,col:rc(cols),width:1+Math.random()*2.5}));
  let T=0;
  const loop=()=>{
    ctx.fillStyle='rgba(3,5,15,.1)';ctx.fillRect(0,0,W,H);T+=.01;
    for(const rb of ribbons){
      ctx.beginPath();let first=true;
      for(let x=0;x<=W;x+=3){
        const n=noise(x*.003+T*.3+rb.phase,T*.2+rb.phase*.5);
        const y=rb.yOff+Math.sin(x*.008+T+rb.phase)*rb.amp+n*rb.amp*.4;
        first?(ctx.moveTo(x,y),first=false):ctx.lineTo(x,y);
      }
      ctx.strokeStyle=rgba(rb.col,.35);ctx.lineWidth=rb.width;ctx.stroke();
      // glow pass
      ctx.strokeStyle=rgba(rb.col,.08);ctx.lineWidth=rb.width*4;ctx.stroke();
    }
    raf=requestAnimationFrame(loop);
  };loop();
},

// 24 BINARY TREE
()=>{
  const cols=getColors();let T=0;
  function branch(x,y,angle,len,depth){
    if(depth===0||len<3)return;
    const ex=x+Math.cos(angle)*len,ey=y+Math.sin(angle)*len;
    const col=cols[depth%cols.length];const a=depth/8*.5;
    ctx.beginPath();ctx.moveTo(x,y);ctx.lineTo(ex,ey);
    ctx.strokeStyle=rgba(col,a);ctx.lineWidth=depth*.4;ctx.stroke();
    const spread=.4+Math.sin(T+depth)*.12;
    branch(ex,ey,angle-spread,len*.68,depth-1);
    branch(ex,ey,angle+spread,len*.68,depth-1);
  }
  const loop=()=>{
    ctx.fillStyle='rgba(3,5,15,.18)';ctx.fillRect(0,0,W,H);T+=.012;
    branch(W/2,H,-(Math.PI/2)+Math.sin(T*.3)*.08,H*.22,9);
    raf=requestAnimationFrame(loop);
  };loop();
},

// 25 LIQUID CRYSTAL
()=>{
  const cols=getColors();const noise=makeNoise();let T=0;
  const RES=8;
  const loop=()=>{
    T+=.006;
    for(let y=0;y<H;y+=RES)for(let x=0;x<W;x+=RES){
      const n=noise(x*.006+T,y*.006+T*.7);
      const n2=noise(x*.012+T*.5,y*.008-T*.3);
      const idx=Math.floor((n+n2+2)/4*cols.length)%cols.length;
      const col=cols[idx];const a=.06+Math.abs(n)*.08;
      ctx.fillStyle=rgba(col,a);ctx.fillRect(x,y,RES,RES);
    }
    raf=requestAnimationFrame(loop);
  };loop();
},

// 26 WORMHOLE TUNNEL
()=>{
  const cols=getColors();let T=0;
  const loop=()=>{
    ctx.fillStyle='rgba(3,5,15,.2)';ctx.fillRect(0,0,W,H);T+=.016;
    const cx=W/2,cy=H/2,rings=22;
    for(let i=rings;i>=0;i--){
      const t2=(i/rings+T*.4)%1;
      const r=t2*Math.min(W,H)*.55;
      const a=(1-t2)*.55;const twist=t2*Math.PI*.5+T;
      const col=cols[i%cols.length];
      const pts=8+i;
      ctx.beginPath();
      for(let j=0;j<=pts;j++){const ang=j/pts*Math.PI*2+twist;ctx.lineTo(cx+Math.cos(ang)*r,cy+Math.sin(ang)*r*(0.5+t2*.5));}
      ctx.strokeStyle=rgba(col,a);ctx.lineWidth=1+t2*1.5;ctx.stroke();
    }
    raf=requestAnimationFrame(loop);
  };loop();
},

// 27 LIGHTNING STORM
()=>{
  const cols=getColors();
  let bolts=[],T=0;
  function mkBolt(){
    const x=Math.random()*W;const pts=[{x,y:0}];let cx2=x;
    for(let i=0;i<12+Math.floor(Math.random()*8);i++){cx2+=(Math.random()-.5)*80;pts.push({x:cx2,y:(i+1)*(H/18)});}
    return{pts,life:0,max:14+Math.floor(Math.random()*10),col:rc(cols),branches:Math.random()>.5?[{pts:pts.slice(0,Math.floor(pts.length*.6)),flip:Math.random()>.5}]:[]};
  }
  const ri=setInterval(()=>{if(bolts.length<4)bolts.push(mkBolt());},600+Math.random()*1400);
  cleanupFn=()=>clearInterval(ri);
  const loop=()=>{
    ctx.fillStyle='rgba(3,5,15,.25)';ctx.fillRect(0,0,W,H);T++;
    for(let i=bolts.length-1;i>=0;i--){
      const b=bolts[i];b.life++;const a=(1-b.life/b.max)*.9;
      const drawPts=(pts)=>{ctx.beginPath();ctx.moveTo(pts[0].x,pts[0].y);for(const p of pts)ctx.lineTo(p.x,p.y);ctx.strokeStyle=rgba(b.col,a);ctx.lineWidth=1.5;ctx.stroke();ctx.strokeStyle=rgba(b.col,a*.3);ctx.lineWidth=4;ctx.stroke();};
      drawPts(b.pts);
      if(b.life>=b.max)bolts.splice(i,1);
    }
    raf=requestAnimationFrame(loop);
  };loop();
},

// 28 CELLULAR AUTOMATA
()=>{
  const cols=getColors();
  const CELL=10;const gc3=Math.floor(W/CELL),gr3=Math.floor(H/CELL);
  let grid=Array.from({length:gr3},()=>Array.from({length:gc3},()=>Math.random()>.72?1:0));
  let next;let T=0;
  const step=()=>{
    next=Array.from({length:gr3},()=>new Array(gc3).fill(0));
    for(let r=0;r<gr3;r++)for(let c=0;c<gc3;c++){
      let n=0;for(let dr=-1;dr<=1;dr++)for(let dc=-1;dc<=1;dc++){if(dr===0&&dc===0)continue;n+=grid[(r+dr+gr3)%gr3][(c+dc+gc3)%gc3];}
      next[r][c]=(grid[r][c]===1&&(n===2||n===3))?1:(grid[r][c]===0&&n===3?1:0);
    }
    grid=next;
  };
  const ri=setInterval(step,120);cleanupFn=()=>clearInterval(ri);
  const loop=()=>{
    ctx.fillStyle='#03050f';ctx.fillRect(0,0,W,H);
    for(let r=0;r<gr3;r++)for(let c=0;c<gc3;c++){
      if(grid[r][c]){const col=cols[(r+c)%cols.length];ctx.fillStyle=rgba(col,.8);ctx.fillRect(c*CELL+1,r*CELL+1,CELL-2,CELL-2);}
    }
    raf=requestAnimationFrame(loop);
  };loop();
},

// 29 ORBITAL RINGS
()=>{
  const cols=getColors();let T=0;
  const orbits=Array.from({length:7},(_,i)=>({
    rx:W*.08+i*(W*.04),ry:H*.04+i*(H*.025),
    tilt:i*.22+.3,speed:.008+i*.003,
    planets:Array.from({length:1+Math.floor(Math.random()*2)},()=>({angle:Math.random()*Math.PI*2,r:2+Math.random()*4,col:rc(cols)})),
    col:cols[i%cols.length]
  }));
  const loop=()=>{
    ctx.fillStyle='rgba(3,5,15,.15)';ctx.fillRect(0,0,W,H);T+=.012;
    const cx=W/2,cy=H/2;
    for(const orb of orbits){
      ctx.save();ctx.translate(cx,cy);ctx.rotate(orb.tilt);
      ctx.beginPath();ctx.ellipse(0,0,orb.rx,orb.ry,0,0,Math.PI*2);
      ctx.strokeStyle=rgba(orb.col,.12);ctx.lineWidth=.8;ctx.stroke();ctx.restore();
      for(const pl of orb.planets){
        pl.angle+=orb.speed;
        const x=cx+Math.cos(pl.angle+orb.tilt)*orb.rx-Math.sin(pl.angle+orb.tilt)*0;
        const y=cy+Math.sin(pl.angle)*orb.ry*Math.cos(orb.tilt)+Math.cos(pl.angle)*orb.ry*Math.sin(orb.tilt)*.4;
        ctx.beginPath();ctx.arc(x,y,pl.r,0,Math.PI*2);ctx.fillStyle=rgba(pl.col,.9);ctx.fill();
        ctx.beginPath();ctx.arc(x,y,pl.r*2.5,0,Math.PI*2);ctx.fillStyle=rgba(pl.col,.12);ctx.fill();
      }
    }
    ctx.beginPath();ctx.arc(cx,cy,6,0,Math.PI*2);ctx.fillStyle=rgba(cols[0],.9);ctx.fill();
    ctx.beginPath();ctx.arc(cx,cy,18,0,Math.PI*2);ctx.fillStyle=rgba(cols[0],.15);ctx.fill();
    raf=requestAnimationFrame(loop);
  };loop();
},

// 30 TERRAIN FLYOVER
()=>{
  const cols=getColors();const noise=makeNoise();let T=0;
  const ROWS=28,COLS2=40;
  const loop=()=>{
    ctx.fillStyle='rgba(3,5,15,.25)';ctx.fillRect(0,0,W,H);T+=.008;
    const horizon=H*.42;
    for(let r=1;r<ROWS;r++){
      const depth=r/ROWS;const y=horizon+depth*H*.55;
      const scale=depth*2.5;const z=T+depth*1.8;
      const pts=[];
      for(let c=0;c<=COLS2;c++){
        const wx=(c/COLS2-.5)*4;
        const h=noise(wx*scale+T*.3,z)*H*.18*depth;
        pts.push({x:W*.1+c/COLS2*W*.8+(c/COLS2-.5)*W*.3*depth,y:y-h});
      }
      const col=cols[r%cols.length];const a=depth*.35;
      ctx.beginPath();ctx.moveTo(pts[0].x,pts[0].y);for(const p of pts)ctx.lineTo(p.x,p.y);
      ctx.strokeStyle=rgba(col,a);ctx.lineWidth=.8;ctx.stroke();
      if(r%3===0)for(let c=0;c<=COLS2;c++){
        const above=r>1?[]:null;
        ctx.beginPath();ctx.moveTo(pts[c].x,pts[c].y);
        const prev_r_y=horizon+(r-1)/ROWS*H*.55;
        const prev_h=noise((c/COLS2-.5)*4*(r-1)/ROWS*2.5+T*.3,T+(r-1)/ROWS*1.8)*H*.18*(r-1)/ROWS;
        ctx.lineTo(W*.1+c/COLS2*W*.8+(c/COLS2-.5)*W*.3*(r-1)/ROWS,prev_r_y-prev_h);
        ctx.strokeStyle=rgba(col,a*.5);ctx.lineWidth=.5;ctx.stroke();
      }
    }
    raf=requestAnimationFrame(loop);
  };loop();
},

];

// ═══════════════════════════════════════════════════════
// BUILD GRID BUTTONS
// ═══════════════════════════════════════════════════════
const grid = document.getElementById('grid');
EFFECTS.forEach((e,i)=>{
  const btn=document.createElement('button');
  btn.className='eBtn'+(i===0?' active':'');
  btn.innerHTML=`<span class="eNum">${String(i+1).padStart(2,'0')}</span>${e.name}`;
  btn.onclick=()=>runEffect(i);
  grid.appendChild(btn);
});

// ═══════════════════════════════════════════════════════
// MODAL / CODE / PROMPT
// ═══════════════════════════════════════════════════════
let modalMode='code';
function openModal(mode){
  modalMode=mode;
  document.getElementById('modal').classList.add('show');
  renderModal();
}
function closeModal(){ document.getElementById('modal').classList.remove('show'); }
function switchTab(tab){ modalMode=tab; document.querySelectorAll('.mTab').forEach((t,i)=>t.classList.toggle('active',['code','prompt'][i]===tab)); renderModal(); }
document.getElementById('modal').addEventListener('click',e=>{ if(e.target===document.getElementById('modal'))closeModal(); });

function getHexColors(){
  return [document.getElementById('colA').value,document.getElementById('colB').value,document.getElementById('colC').value];
}

function renderModal(){
  const ef=EFFECTS[current];
  document.getElementById('modalTitle').textContent=`${ef.name} — Export`;
  const body=document.getElementById('modalBody');
  const [cA,cB,cC]=getHexColors();

  if(modalMode==='code'){
    document.querySelectorAll('.mTab').forEach((t,i)=>t.classList.toggle('active',i===0));
    const code=generateCode(ef.name,cA,cB,cC);
    body.innerHTML=`<pre id="codeBlock">${escHtml(code)}</pre><button id="copyBtn" onclick="copyCode()">Copy to Clipboard</button>`;
  } else {
    document.querySelectorAll('.mTab').forEach((t,i)=>t.classList.toggle('active',i===1));
    const prompt=generatePrompt(ef.name,ef.desc,cA,cB,cC);
    body.innerHTML=`<div class="promptText">${prompt}</div><button id="copyBtn" onclick="copyPrompt()">Copy Prompt</button>`;
  }
}

function escHtml(s){ return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

function copyCode(){
  const code=generateCode(EFFECTS[current].name,...getHexColors());
  navigator.clipboard.writeText(code).then(()=>{document.getElementById('copyBtn').textContent='Copied!';setTimeout(()=>document.getElementById('copyBtn').textContent='Copy to Clipboard',2000);});
}
function copyPrompt(){
  const ef=EFFECTS[current];
  const prompt=generatePromptRaw(ef.name,ef.desc,...getHexColors());
  navigator.clipboard.writeText(prompt).then(()=>{document.getElementById('copyBtn').textContent='Copied!';setTimeout(()=>document.getElementById('copyBtn').textContent='Copy Prompt',2000);});
}

function generateCode(name,cA,cB,cC){
return `<!-- ══════════════════════════════════════════
  BACKGROUND EFFECT: ${name}
  Colors: A=${cA}  B=${cB}  C=${cC}
  ── Drop this <canvas> tag right after <body>
  ── Drop the <script> before </body>
  ── The canvas is position:fixed, z-index:0
  ══════════════════════════════════════════ -->

<!-- 1. ADD THIS RIGHT AFTER YOUR <body> TAG -->
<canvas id="bgCanvas" style="position:fixed;top:0;left:0;width:100%;height:100%;z-index:0;pointer-events:none;"></canvas>

<!-- 2. MAKE SURE YOUR CONTENT HAS z-index > 0 -->
<style>
  body { background: #03050f; }
  /* wrap all your page content in a div with: */
  .content { position: relative; z-index: 1; }
</style>

<!-- 3. ADD THIS BEFORE YOUR </body> TAG -->
<script>
(function(){
  const canvas = document.getElementById('bgCanvas');
  const ctx = canvas.getContext('2d');
  const COLORS = ['${cA}','${cB}','${cC}'];
  let W, H, raf;

  function hexToRgb(h){
    return [parseInt(h.slice(1,3),16),parseInt(h.slice(3,5),16),parseInt(h.slice(5,7),16)];
  }
  const COLS = COLORS.map(hexToRgb);
  function rgba(c,a){ return \`rgba(\${c[0]},\${c[1]},\${c[2]},\${a})\`; }
  function rc(){ return COLS[Math.floor(Math.random()*COLS.length)]; }

  function resize(){
    W = canvas.width  = window.innerWidth;
    H = canvas.height = window.innerHeight;
  }
  resize();
  window.addEventListener('resize', resize);

  // ── EFFECT: ${name} ──
  // Replace this function body with the effect of your choice.
  // All effects use W, H, ctx, COLS, rgba(), rc() defined above.
  function startEffect(){
    // [EFFECT CODE GOES HERE — use "Get AI Prompt" tab to
    //  have Claude/Gemini/ChatGPT generate the full implementation
    //  tailored to your existing website]
  }

  startEffect();
})();
<\/script>`;
}

function generatePromptRaw(name,desc,cA,cB,cC){
return `You are an expert frontend developer specialising in HTML5 Canvas animation.

I need you to implement a dynamic animated background effect called "${name}" into my existing website.

EFFECT DESCRIPTION:
${desc}

COLOR PALETTE (use only these three colors for the effect):
- Color A: ${cA}
- Color B: ${cB}  
- Color C: ${cC}
- Background: #03050f (very dark navy)

TECHNICAL REQUIREMENTS:
1. Use a single <canvas> element with id="bgCanvas", position:fixed, top:0, left:0, width:100%, height:100%, z-index:0, pointer-events:none
2. All existing page content must sit above the canvas (z-index >= 1)
3. Use requestAnimationFrame for the animation loop — never setInterval for drawing
4. Handle window resize gracefully WITHOUT restarting or flickering the animation
5. The effect must loop seamlessly with no visible restarts
6. Keep the effect subtle enough that text and UI elements placed over it remain legible
7. The canvas fade/trail overlay should use rgba(3,5,15, X) where X controls trail length
8. The script must be self-contained — no external libraries

INTEGRATION INSTRUCTIONS:
- Add <canvas id="bgCanvas"> immediately after the opening <body> tag
- Add the <script> block immediately before the closing </body> tag
- Add body { background: #03050f; } to the existing CSS
- Wrap all existing page content in a container with position:relative; z-index:1

Please provide:
1. The complete self-contained <script> block implementing the "${name}" effect
2. Any CSS additions needed
3. A one-line comment showing exactly where to insert the canvas tag

The implementation should be production-quality, performant (60fps on mid-range devices), and visually impressive.`;
}

function generatePrompt(name,desc,cA,cB,cC){
  const raw=generatePromptRaw(name,desc,cA,cB,cC);
  return raw.split('\n').map(line=>{
    if(line.startsWith('You are')||line.startsWith('I need')||line.startsWith('Please'))
      return `<strong>${escHtml(line)}</strong>`;
    if(line.startsWith('-')||line.startsWith('Color')||/^\d\./.test(line))
      return `&nbsp;&nbsp;${escHtml(line)}`;
    return escHtml(line)||'&nbsp;';
  }).join('<br/>');
}

// Start
runEffect(0);
</script>
</body>
</html>
